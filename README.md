# Вариант №30

## Транслятор учебного конфигурационного языка в YAML

Эта работа посвящена реализации небольшого инструмента командной строки, который принимает файл с конфигурацией на учебном языке, проверяет синтаксис, вычисляет константы, и формирует корректный YAML-файл.
Все ошибки должны выводиться с указанием строки и столбца — это одно из требований варианта.

Работу я выполнял постепенно, шаг за шагом — ниже описано, что именно реализовано и как это проверяется.

---

# 1. Структура проекта

В проекте находятся:

* **`conf2yaml/`** — основной модуль транслятора
  Здесь лексер, парсер, генератор YAML и CLI.
* **`tests/`** — набор тестов, покрывающий все конструкции языка
  (вложенность, ошибки, подстановки, `let`, массивы и т.п.).
* **`examples/`** — 2 примера конфигураций из разных предметных областей + один пример с ошибкой.
* **`README.md`** — документ, который вы читаете сейчас.
* **`out/`** — каталог, куда сохраняются YAML-файлы (создаётся автоматически).

---

# 2. Учебный язык: синтаксис, который я поддерживаю

При разработке я опирался на формальные правила из задания. Вот краткое, человеческое описание.

## Комментарии

Однострочные, начинаются с `REM`:

```
REM пример
let x = 1 REM комментарий справа
```

## Числа

Только неотрицательные целые (`\d+`):

```
42
0
300
```

## Имена

Строчные латинские буквы, цифры и подчёркивание, но начинаться должно с буквы:

```
a
base_period
sensor_1
```

Неверные:

```
A
1abc
_x
```

## Массивы

Описываются конструкцией:

```
(list значение значение ... )
```

Пример:

```
(list 1 2 (list 3 4))
```

## Константы

Можно объявлять:

```
let name = значение
```

И использовать:

```
!{name}
```

При этом значение **подставляется полностью**, со всеми вложенными структурами.

---

# 3. Как должен выглядеть входной файл

Файл состоит из:

1. Нуля или более строк `let ...`
2. **Одного** корневого значения, которое и будет результатом

Пример корректного файла:

```
let a = 10
let b = (list 1 2 3)
(list !{a} !{b} 99)
```

Если корневых значений два или больше — это ошибка, и парсер корректно её покажет.

---

# 4. Запуск проекта

Ниже — моё последовательное тестирование после реализации.




### 1) Запустил тесты

```
python -m unittest discover -s tests -p "test_*.py" -q
```

Все тесты проходят — это значит, что каждая конструкция языка обрабатывается корректно.

---

### 2) Проверил работу транслятора на примерах

#### IoT-пример:

```
python -m conf2yaml -i examples/iot.cfg -o out/iot.yaml
```

#### Игровой пример:

```
python -m conf2yaml -i examples/game.cfg -o out/game.yaml
```

---

### 3) Проверил корректность вывода

`out/iot.yaml:`

```yaml
- 60
- - 101
  - 102
  - 103
- - 301
  - 302
- 300
```

`out/game.yaml:`

```yaml
- - 5
  - 8
  - 12
- - 3
  - 2
  - 1
  - 0
- - 1
  - 1
  - 0
- 120
```

структуры полностью соответствуют входным файлам.

---

### 4) Проверил ошибки

Например, использование необъявленной константы:

```
python -m conf2yaml -i examples/bad_undeclared.cfg -o out/x.yaml
```

Результат:

```
Undeclared constant 'x' at line ...
```

---

# 5. CLI утилита

Запуск:

```
python -m conf2yaml -i INPUT_FILE -o OUTPUT_FILE
```

Где:

* `INPUT_FILE` — файл на учебном языке (`.cfg`)
* `OUTPUT_FILE` — путь к YAML-файлу (`.yaml`)

Коды выхода:

* `0` — всё хорошо
* `2` — проблемы с файлами/путями
* `3` — синтаксическая ошибка или неизвестная константа
* `1` — непредвиденная ошибка

---

# 6. Примеры (разные области)

## Пример 1 — IoT/телеметрия

`examples/iot.cfg`:

```
REM периоды и наборы датчиков
let base_period = 60
let temp_sensors = (list 101 102 103)
let vibro_sensors = (list 301 302)

(list !{base_period} !{temp_sensors} !{vibro_sensors} 300)
```

YAML:

```yaml
- 60
- - 101
  - 102
  - 103
- - 301
  - 302
- 300
```

---

## Пример 2 — игровой уровень

`examples/game.cfg`:

```
REM базовые параметры уровня
let waves = (list 5 8 12)
let boss = 1
let pickups = (list 3 2 1 0)

(list !{waves} !{pickups} (list !{boss} 1 0) 120)
```

YAML:

```yaml
- - 5
  - 8
  - 12
- - 3
  - 2
  - 1
  - 0
- - 1
  - 1
  - 0
- 120
```

---

# 7. Что проверяют тесты

Тестами покрыто:

* корректная работа `REM`
* числа
* массивы и вложенные массивы
* объявления `let`
* подстановки `!{name}`
* порядок вычисления констант
* ошибки:

  * неизвестная константа
  * неправильное имя
  * пропущенные скобки и ключевые слова
  * несколько корневых значений

Все тесты проходят — поведение стабильно.

---

# Итог

Инструмент реализует весь требуемый функционал варианта №30:

* разбор учебного конфигурационного языка
* вычисление констант
* подстановки `!{name}`
* генерация YAML
* сообщения об ошибках с координатами
* тесты на все конструкции
* два реалистичных примера
